<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebPongJS :: sockJS proof of concept</title>

    <!-- Library includes -->
    <script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>
    <script src="http://jashkenas.github.com/coffee-script/extras/coffee-script.js"></script>

    <!-- WebPongJS includes -->
    <script src="../common/game.js"></script>
    <script src="../common/config.js"></script>

    <!-- Game -->
    <script type="text/coffeescript">
      conf = window.WebPongJSConfig
      sock = new SockJS "http://#{conf.server.addr}:#{conf.server.port}#{conf.server.prefix}"

      sock.onmessage = (e) ->
        diff = Math.abs(e.data - (new Date).getTime())
        console.log '[message]', diff
        if diff > conf.update.maxDrift
          console.log 'Want update'
          sock.send 'update'

      sock.onopen = ->
        console.log 'Connected, sending hi'
        sock.send 'Hi, dude!'
        sock.send 'Hi again, dude!'

      sock.onclose = ->
        console.log 'Connection closed'
    </script>
  </head>

  <body>
    <canvas id="paper" width="1900" height="1000">
    Your browser needs to support canvas for this to work!
    </canvas>
  </body>
</html>
